
node 
{ 
   	stage('Clone Repository') 
	{        		


		withCredentials([usernamePassword(credentialsId: 'GIT_LAB_FULL', usernameVariable: 'USERNAME', passwordVariable: 'API_TOKEN')])
		{
			//git branch:'main' url: "https://$API_TOKEN@gitlab.com/sagecarey/test.git"
			//sh 'git branch url:\'https://$API_TOKEN@gitlab.com/sagecarey/mbsa.git\''
			//https://gitlab.com/ralphccarey/mbsa.git
			def cloneCommand = 'git clone https://user:$API_TOKEN@gitlab.com/ralphccarey/mbsa.git /var/lib/jenkins/workspace/mbsa'						
			def checkOutCommand = 'git checkout https://user:$API_TOKEN@gitlab.com/ralphccarey/mbsa.git'						
			//sh "echo $cloneCommand"
			sh "if [ -d /var/lib/jenkins/workspace/mbsa/.git ];then  $checkOutCommand;else $cloneCommand;fi"
			//sh cloneCommand
			sh 'git status' //this is just for debug			
		}
   	}
    	stage('Add Files')
	{
        	echo 'Adding Files'
		sh "echo 'New file 1' > data1.txt"
		sh "echo 'var a=0' >>data1.txt"
		sh "echo 'var b=1' >>data1.txt"
		sh "echo 'New File 2' >data2.txt"
		sh "echo 'Color\tSize' >>data2.txt"
		sh "echo 'Blue\tLarge' >>data2.txt"
    	}
	stage('Check-in')
	{
        	withCredentials([usernamePassword(credentialsId: 'GIT_LAB_FULL', usernameVariable: 'USERNAME', passwordVariable: 'API_TOKEN')])
		{
			echo 'Checking in new files'
			sh 'git status' //this is just for debug
			sh 'git add data1.txt'
			sh 'git add data2.txt'
			sh 'git commit -m \"Added data1 and data2\"'
			sh 'git status'
			def pushCommand = 'git push https://user:$API_TOKEN@gitlab.com/ralphccarey/mbsa.git'					
			println("Push Command = " + pushCommand)
			sh pushCommand			
		}
    	}
}
